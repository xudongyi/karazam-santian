$().ready(function() {    var $registBasicForm = $("#registBasicForm"),        $flashMessage = $("#flashMessage"),        $submit = $registBasicForm.find(":submit"),        rsaKey = new RSAKey();        $userType = $("input:checked").val();    var $mobile = $("#mobile"),        $password = $("#password"),        $rePassword = $("#rePassword"),        $captcha = $("#captcha");        $referrer = $("#referrer"),        $mobileFlashMessage = $("#mobileFlashMessage"),        $captchaButton = $("#captchaButton");    $submit.prop("disabled", false);    rsaKey.setPublic(b64tohex(modules), b64tohex(exponent));    var $validate = $registBasicForm.validate({        rules: {            mobile: {                required: true,                pattern: /^1[3,4,5,7,8]\d{9}$/,                remote: {                    url: ctx + "/forgetPassword/check_mobile?type=" + $userType,                    type: "post",                    cache: false                }            },            password: {                required: true,                pattern: /^(?![0-9]+$)(?![a-zA-Z]+$)[0-9a-zA-Z_]+$/,                minlength: 4,                maxlength: 20            },            // rePassword: {            //     required: true,            //     equalTo: "#password"            // },            captcha:{                required: true            },            agreement: "required"        },        messages: {            mobile: {                required: "请输入您的手机号码",                pattern: "请输入正确的手机号码",                remote: "手机号码不存在"            },            password: {                required: "请输入4-20位密码",                pattern: "密码必须由数字字母组合",                minlength: "请输入4-20位密码",                maxlength: "请输入4-20位密码"            },            // rePassword: {            //     required: "请输入确认密码",            //     equalTo: "两次密码输入不一致"            // },            captcha:{                required: "请输入验证码"            },            agreement: "请先阅读《注册协议》并确认同意"        },        errorPlacement: function(error, element) {            element.closest(".errorcls").find(".errorMessage").text(error.text());            element.closest(".errorcls").find(".errorMessage").addClass("icon");            $submit.prop("disabled", true);            $flashMessage.text("");        },        unhighlight: function(element) {            $(element).closest(".errorcls").find(".errorMessage").text("");            $(element).closest(".errorcls").find(".errorMessage").removeClass("icon");            $submit.prop("disabled", false);            $flashMessage.text("");        },        submitHandler: function(form) {            $submit.prop("disabled", true);            $.ajax({                url: ctx + "/forgetPassword/do",                type: "post",                data: {                    mobile: $mobile.val(),                    password: hex2b64(rsaKey.encrypt($password.val())),                    referrer: $referrer.val(),                    captcha:$captcha.val(),                    modules: modules,                    exponent: exponent,                    type:$("input:checked").val()                },                dataType: "json",                cache: false,                beforeSend: function(request, settings) {                    // $submit.attr("data-toggle","");                    request.setRequestHeader("token", $.cookie("token"));                    $submit.val(" 重置密码中 ... ");                },                success: function(data) {                    console.log($mobile.val()+'0000--'+$("input:checked").val());                    if (data.status == "success") {                         window.location.href = ctx + "/login";                    } else {                        $flashMessage.text(data.message);                        $captcha.val("");                        $submit.val("重置密码");                        $submit.prop("disabled", false);                    }                },                error: function() {                    $flashMessage.text("重置密码失败，请刷新页面重试");                    $submit.val(" 重 置 失 败 ");                }            });        }    });    $captchaButton.click(function () {        $captchaButton.prop("disabled", true);        if (!$validate.element($mobile)) {            $captchaButton.prop("disabled", false);            return false;        }        $.ajax({            url: ctx + "/forgetPassword/sendMessage?type=" + $userType,            data: {                mobile: $mobile.val(),                type:$("input:checked").val()            },            type: "post",            dataType: "json",            cache: false,            success: function (data) {                if (data.status == "success") {                    $mobileFlashMessage.text("");                    $mobileFlashMessage.removeClass("icon");                    $disableButton($captchaButton, 60);                } else {                    $mobileFlashMessage.text(data.message);                    $mobileFlashMessage.addClass("icon");                    $captchaButton.prop("disabled", false);                }            }        });    });    $disableButton = function(button, seconds) {        var previousValue = button.val();        var className = button.attr("disableClassName");        var promptValueSuffix = button.attr("disablePromptValueSuffix");        var promptValue = seconds + "秒" + promptValueSuffix;        button.prop("disabled", true);        button.addClass(className);        button.val(promptValue);        intervalId = window.setInterval(function() {            seconds -= 1;            promptValue = seconds + "秒" + promptValueSuffix;            button.val(promptValue);            if(seconds == 0) {                window.clearInterval(intervalId);                button.prop("disabled", false);                button.removeClass(className);                button.val(previousValue);            }        }, 1000);    };    /*点击眼睛改变密码输入框type属性使密码输入可见*/    $('#toggle-pwd1').click(function () {        if ($(this).hasClass('see-pwd')) {            $('#password').attr("type", "text");            $(this).removeClass('see-pwd');        } else {            $('#password').attr("type", "password");            $(this).addClass('see-pwd');        }    })    $('#toggle-pwd2').click(function () {        if ($(this).hasClass('see-pwd')) {            $('#rePassword').attr("type", "text");            $(this).removeClass('see-pwd');        } else {            $('#rePassword').attr("type", "password");            $(this).addClass('see-pwd');        }    })    $(":radio").change(function(){        $userType = $("input:checked").val();        console.log($userType);        var $mobile = $("#mobile");        $mobile.val("");        $mobile.rules("remove");        $mobile.rules("add",{            remote: {                url: ctx + "/forgetPassword/check_mobile?type=" + $userType,                type: "post",                cache: false            },            messages:{                remote: "手机号码已存在"            }        });        $validate.element($mobile);    });});